{% load static %}
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Zamówień - CNC Tools</title>
    <link rel="icon" href="{% static 'images/cnc-logo.png' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <style>
        html, body { height: 100%; overflow: hidden; background-color: #f8f9fa; margin: 0; }
        #app { height: 100%; display: flex; flex-direction: column; }
        .table-hover tbody tr:hover { background-color: #e9ecef; }
        .badge { font-size: 0.85rem; }
        .status-draft { background-color: #6c757d; }
        .status-verified { background-color: #0dcaf0; }
        .status-sent { background-color: #0d6efd; }
        .status-partially_received { background-color: #ffc107; }
        .status-completed { background-color: #198754; }
    </style>
</head>
<body>
    <div id="app">
        <div class="d-flex justify-content-between align-items-center p-3 px-4 text-light border-bottom border-secondary" style="background: linear-gradient(to bottom, #495057, #212529);">
            <h2 class="mb-0"><strong>CNC MILLING: <span style="color: yellow;">Zamówienia</span></strong></h2>
            <div class="btn-group" role="group" aria-label="Basic mixed styles example">
                <a href="{% url 'ustawienia' %}?next={% url 'zamowienia' %}" class="btn btn-secondary shadow-sm" title="Ustawienia" style="margin-right: 5px;"><i class="fa-solid fa-gear"></i> Ustawienia</a>
                <a href="{% url 'faktury' %}?next={% url 'zamowienia' %}" class="btn btn-primary shadow-sm text-white" title="Faktury" style="margin-right: 5px;"><i class="fa-solid fa-file-invoice-dollar"></i> Faktury</a>
                <a href="{% url 'magazyn' %}" class="btn btn-light shadow-sm" title="Przełącz na panel Magazyniera" style="margin-left: 5px;"><i class="fa-solid fa-warehouse"></i> Magazyn</a>
                <a href="{% url 'zakupy' %}" class="btn btn-light shadow-sm" title="Przełącz na panel Zakupy" style="margin-left: 5px;"><i class="fa-solid fa-truck"></i> Zakupy</a>
                <a href="{% url 'logout' %}" class="btn btn-danger shadow-sm" title="Wyloguj" style="margin-left: 5px;"><i class="fa-solid fa-right-from-bracket"></i> Wyjście</a>
            </div>
        </div>

        <main class="container-fluid px-4 pt-4 pb-3 d-flex flex-column" style="flex: 1; min-height: 0;">
            <!-- Lista zamówień -->
            <div class="card shadow mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">Lista zamówień</h3>
                    <div>
                        <button class="btn btn-success shadow-sm me-2" @click="generujAutomatyczne" title="Generuj zamówienia automatycznie">
                            <i class="fas fa-magic"></i> Generuj automatycznie
                        </button>
                        <button class="btn btn-primary shadow-sm" @click="openZamowienieModal('add')" title="Dodaj nowe zamówienie">
                            <i class="fas fa-plus"></i> Nowe zamówienie
                        </button>
                    </div>
                </div>
                <div class="card-body p-0" style="overflow-y: auto; max-height: 400px;">
                    <table class="table table-hover mb-0">
                        <thead class="bg-light sticky-top">
                            <tr>
                                <th>Numer</th>
                                <th>Dostawca</th>
                                <th>Data utworzenia</th>
                                <th>Data wysłania</th>
                                <th>Status</th>
                                <th>Pozycje</th>
                                <th class="text-center">Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="zamowienia.length === 0">
                                <td colspan="7" class="text-center text-muted p-3">Brak zamówień</td>
                            </tr>
                            <tr v-for="zamowienie in zamowienia" :key="zamowienie.id" style="cursor: pointer;" @click="selectZamowienie(zamowienie)">
                                <td><strong>[[ zamowienie.numer ]]</strong></td>
                                <td>[[ zamowienie.dostawca.nazwa_firmy ]]</td>
                                <td>[[ formatDate(zamowienie.data_utworzenia) ]]</td>
                                <td>[[ zamowienie.data_wyslania ? formatDate(zamowienie.data_wyslania) : '-' ]]</td>
                                <td><span :class="'badge status-' + zamowienie.status">[[ getStatusLabel(zamowienie.status) ]]</span></td>
                                <td>[[ zamowienie.pozycje.length ]]</td>
                                <td class="text-center">
                                    <button v-if="zamowienie.status === 'draft' || zamowienie.status === 'verified'"
                                            class="btn btn-sm btn-info shadow-sm me-1"
                                            @click.stop="wyslijEmail(zamowienie.id)"
                                            title="Wyślij e-mail">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                    <button v-if="zamowienie.status === 'sent' || zamowienie.status === 'partially_received'"
                                            class="btn btn-sm btn-warning shadow-sm me-1"
                                            @click.stop="rozpocznijRealizacje(zamowienie.id)"
                                            title="Rozpocznij realizację">
                                        <i class="fas fa-clipboard-check"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary shadow-sm"
                                            @click.stop="openZamowienieModal('edit', zamowienie)"
                                            title="Edytuj">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Szczegóły wybranego zamówienia -->
            <div v-if="selectedZamowienie" class="card shadow">
                <div class="card-header">
                    <h4 class="mb-0">Szczegóły zamówienia: [[ selectedZamowienie.numer ]]</h4>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Dostawca:</strong> [[ selectedZamowienie.dostawca.nazwa_firmy ]]<br>
                            <strong>NIP:</strong> [[ selectedZamowienie.dostawca.nip || '-' ]]<br>
                            <strong>Email:</strong> [[ selectedZamowienie.dostawca.email || '-' ]]
                        </div>
                        <div class="col-md-6">
                            <strong>Status:</strong> <span :class="'badge status-' + selectedZamowienie.status">[[ getStatusLabel(selectedZamowienie.status) ]]</span><br>
                            <strong>Data utworzenia:</strong> [[ formatDate(selectedZamowienie.data_utworzenia) ]]<br>
                            <strong>Data wysłania:</strong> [[ selectedZamowienie.data_wyslania ? formatDate(selectedZamowienie.data_wyslania) : '-' ]]
                        </div>
                    </div>

                    <h5>Pozycje zamówienia:</h5>
                    <table class="table table-sm table-bordered">
                        <thead class="bg-light">
                            <tr>
                                <th>Narzędzie</th>
                                <th>Ilość zamówiona</th>
                                <th>Jednostka</th>
                                <th>Szt. w komplecie</th>
                                <th>Cena jedn.</th>
                                <th>Dostarczone</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="pozycja in selectedZamowienie.pozycje" :key="pozycja.id">
                                <td>[[ pozycja.narzedzie_typ.opis ]]</td>
                                <td>[[ pozycja.ilosc_zamowiona ]]</td>
                                <td>[[ pozycja.jednostka ]]</td>
                                <td>[[ pozycja.ilosc_w_komplecie ]]</td>
                                <td>[[ pozycja.cena_jednostkowa ? pozycja.cena_jednostkowa + ' zł' : '-' ]]</td>
                                <td>[[ pozycja.ilosc_dostarczona ]]</td>
                                <td>
                                    <span v-if="pozycja.zrealizowane" class="badge bg-success">Zrealizowane</span>
                                    <span v-else class="badge bg-secondary">Oczekuje</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div v-if="selectedZamowienie.uwagi" class="alert alert-info">
                        <strong>Uwagi:</strong> [[ selectedZamowienie.uwagi ]]
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal dodawania/edycji zamówienia -->
        <div class="modal fade" tabindex="-1" ref="zamowienieModal">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">[[ zamowienieModal.title ]]</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div v-if="zamowienieModal.errorMessage" class="alert alert-danger">
                            [[ zamowienieModal.errorMessage ]]
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Numer zamówienia</label>
                            <input type="text" class="form-control" v-model="zamowienieModal.currentItem.numer">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Dostawca</label>
                            <select class="form-select" v-model="zamowienieModal.currentItem.dostawca_id">
                                <option :value="null">-- Wybierz dostawcę --</option>
                                <option v-for="dostawca in dostawcy" :key="dostawca.id" :value="dostawca.id">
                                    [[ dostawca.nazwa_firmy ]]
                                </option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Uwagi</label>
                            <textarea class="form-control" rows="3" v-model="zamowienieModal.currentItem.uwagi"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                        <button type="button" class="btn btn-primary" @click="saveZamowienie" :disabled="isSaving">
                            <span v-if="isSaving" class="spinner-border spinner-border-sm me-1"></span>
                            Zapisz
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'js/vue.global.js' %}"></script>
    <script src="{% static 'js/axios.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/main_zamowienia.js' %}?v=1.0"></script>
</body>
</html>





































<!--{% load static %}-->
<!--<!DOCTYPE html>-->
<!--<html lang="pl">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Panel Zamówień - CNC Tools</title>-->
<!--    <link rel="icon" href="{% static 'images/cnc-logo.png' %}">-->
<!--    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">-->
<!--    <link rel="stylesheet" href="{% static 'css/all.min.css' %}">-->
<!--    <link rel="stylesheet" href="{% static 'css/main.css' %}">-->
<!--    <style>-->
<!--        html, body { height: 100%; overflow: hidden; background-color: #f8f9fa; margin: 0; }-->
<!--        #app { height: 100%; display: flex; flex-direction: column; }-->
<!--        .table-hover tbody tr:hover { background-color: #e9ecef; }-->
<!--        .badge { font-size: 0.85rem; }-->
<!--        .status-draft { background-color: #6c757d; }-->
<!--        .status-verified { background-color: #0dcaf0; }-->
<!--        .status-sent { background-color: #0d6efd; }-->
<!--        .status-partially_received { background-color: #ffc107; }-->
<!--        .status-completed { background-color: #198754; }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--    <div id="app">-->
<!--        <div class="d-flex justify-content-between align-items-center p-3 px-4 text-light border-bottom border-secondary" style="background: linear-gradient(to bottom, #495057, #212529);">-->
<!--            <h2 class="mb-0"><strong>CNC MILLING: <span style="color: yellow;">Zamówienia</span></strong></h2>-->
<!--            <div>-->
<!--                <a href="{% url 'magazyn' %}" class="btn btn-light shadow-sm" title="Magazyn" style="margin-right: 30px;"><i class="fa-solid fa-warehouse"></i></a>-->
<!--                <a href="{% url 'zakupy' %}" class="btn btn-primary shadow-sm text-white" title="Panel Zakupy"><i class="fa-solid fa-truck"></i></a>-->
<!--                <a href="{% url 'logout' %}" class="btn btn-danger shadow-sm" title="Wyloguj" style="margin-left: 30px;"><i class="fa-solid fa-right-from-bracket"></i></a>-->
<!--            </div>-->
<!--        </div>-->

<!--        <main class="container-fluid px-4 pt-4 pb-3 d-flex flex-column" style="flex: 1; min-height: 0;">-->
<!--            &lt;!&ndash; Lista zamówień &ndash;&gt;-->
<!--            <div class="card shadow mb-4">-->
<!--                <div class="card-header d-flex justify-content-between align-items-center">-->
<!--                    <h3 class="mb-0">Lista zamówień</h3>-->
<!--                    <div>-->
<!--                        <button class="btn btn-success shadow-sm me-2" @click="generujAutomatyczne" title="Generuj zamówienia automatycznie">-->
<!--                            <i class="fas fa-magic"></i> Generuj automatycznie-->
<!--                        </button>-->
<!--                        <button class="btn btn-primary shadow-sm" @click="openZamowienieModal('add')" title="Dodaj nowe zamówienie">-->
<!--                            <i class="fas fa-plus"></i> Nowe zamówienie-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="card-body p-0" style="overflow-y: auto; max-height: 400px;">-->
<!--                    <table class="table table-hover mb-0">-->
<!--                        <thead class="bg-light sticky-top">-->
<!--                            <tr>-->
<!--                                <th>Numer</th>-->
<!--                                <th>Dostawca</th>-->
<!--                                <th>Data utworzenia</th>-->
<!--                                <th>Data wysłania</th>-->
<!--                                <th>Status</th>-->
<!--                                <th>Pozycje</th>-->
<!--                                <th class="text-center">Akcje</th>-->
<!--                            </tr>-->
<!--                        </thead>-->
<!--                        <tbody>-->
<!--                            <tr v-if="zamowienia.length === 0">-->
<!--                                <td colspan="7" class="text-center text-muted p-3">Brak zamówień</td>-->
<!--                            </tr>-->
<!--                            <tr v-for="zamowienie in zamowienia" :key="zamowienie.id" style="cursor: pointer;" @click="selectZamowienie(zamowienie)">-->
<!--                                <td><strong>[[ zamowienie.numer ]]</strong></td>-->
<!--                                <td>[[ zamowienie.dostawca.nazwa_firmy ]]</td>-->
<!--                                <td>[[ formatDate(zamowienie.data_utworzenia) ]]</td>-->
<!--                                <td>[[ zamowienie.data_wyslania ? formatDate(zamowienie.data_wyslania) : '-' ]]</td>-->
<!--                                <td><span :class="'badge status-' + zamowienie.status">[[ getStatusLabel(zamowienie.status) ]]</span></td>-->
<!--                                <td>[[ zamowienie.pozycje.length ]]</td>-->
<!--                                <td class="text-center">-->
<!--                                    <button v-if="zamowienie.status === 'draft' || zamowienie.status === 'verified'"-->
<!--                                            class="btn btn-sm btn-info shadow-sm me-1"-->
<!--                                            @click.stop="wyslijEmail(zamowienie.id)"-->
<!--                                            title="Wyślij e-mail">-->
<!--                                        <i class="fas fa-envelope"></i>-->
<!--                                    </button>-->
<!--                                    <button v-if="zamowienie.status === 'sent' || zamowienie.status === 'partially_received'"-->
<!--                                            class="btn btn-sm btn-warning shadow-sm me-1"-->
<!--                                            @click.stop="rozpocznijRealizacje(zamowienie.id)"-->
<!--                                            title="Rozpocznij realizację">-->
<!--                                        <i class="fas fa-clipboard-check"></i>-->
<!--                                    </button>-->
<!--                                    <button class="btn btn-sm btn-secondary shadow-sm"-->
<!--                                            @click.stop="openZamowienieModal('edit', zamowienie)"-->
<!--                                            title="Edytuj">-->
<!--                                        <i class="fas fa-edit"></i>-->
<!--                                    </button>-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Szczegóły wybranego zamówienia &ndash;&gt;-->
<!--            <div v-if="selectedZamowienie" class="card shadow">-->
<!--                <div class="card-header">-->
<!--                    <h4 class="mb-0">Szczegóły zamówienia: [[ selectedZamowienie.numer ]]</h4>-->
<!--                </div>-->
<!--                <div class="card-body">-->
<!--                    <div class="row mb-3">-->
<!--                        <div class="col-md-6">-->
<!--                            <strong>Dostawca:</strong> [[ selectedZamowienie.dostawca.nazwa_firmy ]]<br>-->
<!--                            <strong>NIP:</strong> [[ selectedZamowienie.dostawca.nip || '-' ]]<br>-->
<!--                            <strong>Email:</strong> [[ selectedZamowienie.dostawca.email || '-' ]]-->
<!--                        </div>-->
<!--                        <div class="col-md-6">-->
<!--                            <strong>Status:</strong> <span :class="'badge status-' + selectedZamowienie.status">[[ getStatusLabel(selectedZamowienie.status) ]]</span><br>-->
<!--                            <strong>Data utworzenia:</strong> [[ formatDate(selectedZamowienie.data_utworzenia) ]]<br>-->
<!--                            <strong>Data wysłania:</strong> [[ selectedZamowienie.data_wyslania ? formatDate(selectedZamowienie.data_wyslania) : '-' ]]-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    <h5>Pozycje zamówienia:</h5>-->
<!--                    <table class="table table-sm table-bordered">-->
<!--                        <thead class="bg-light">-->
<!--                            <tr>-->
<!--                                <th>Narzędzie</th>-->
<!--                                <th>Ilość zamówiona</th>-->
<!--                                <th>Jednostka</th>-->
<!--                                <th>Szt. w komplecie</th>-->
<!--                                <th>Cena jedn.</th>-->
<!--                                <th>Dostarczone</th>-->
<!--                                <th>Status</th>-->
<!--                            </tr>-->
<!--                        </thead>-->
<!--                        <tbody>-->
<!--                            <tr v-for="pozycja in selectedZamowienie.pozycje" :key="pozycja.id">-->
<!--                                <td>[[ pozycja.narzedzie_typ.opis ]]</td>-->
<!--                                <td>[[ pozycja.ilosc_zamowiona ]]</td>-->
<!--                                <td>[[ pozycja.jednostka ]]</td>-->
<!--                                <td>[[ pozycja.ilosc_w_komplecie ]]</td>-->
<!--                                <td>[[ pozycja.cena_jednostkowa ? pozycja.cena_jednostkowa + ' zł' : '-' ]]</td>-->
<!--                                <td>[[ pozycja.ilosc_dostarczona ]]</td>-->
<!--                                <td>-->
<!--                                    <span v-if="pozycja.zrealizowane" class="badge bg-success">Zrealizowane</span>-->
<!--                                    <span v-else class="badge bg-secondary">Oczekuje</span>-->
<!--                                </td>-->
<!--                            </tr>-->
<!--                        </tbody>-->
<!--                    </table>-->

<!--                    <div v-if="selectedZamowienie.uwagi" class="alert alert-info">-->
<!--                        <strong>Uwagi:</strong> [[ selectedZamowienie.uwagi ]]-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </main>-->

<!--        &lt;!&ndash; Modal dodawania/edycji zamówienia &ndash;&gt;-->
<!--        <div class="modal fade" tabindex="-1" ref="zamowienieModal">-->
<!--            <div class="modal-dialog modal-lg">-->
<!--                <div class="modal-content">-->
<!--                    <div class="modal-header">-->
<!--                        <h5 class="modal-title">[[ zamowienieModal.title ]]</h5>-->
<!--                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>-->
<!--                    </div>-->
<!--                    <div class="modal-body">-->
<!--                        <div v-if="zamowienieModal.errorMessage" class="alert alert-danger">-->
<!--                            [[ zamowienieModal.errorMessage ]]-->
<!--                        </div>-->
<!--                        <div class="mb-3">-->
<!--                            <label class="form-label">Numer zamówienia</label>-->
<!--                            <input type="text" class="form-control" v-model="zamowienieModal.currentItem.numer">-->
<!--                        </div>-->
<!--                        <div class="mb-3">-->
<!--                            <label class="form-label">Dostawca</label>-->
<!--                            <select class="form-select" v-model="zamowienieModal.currentItem.dostawca_id">-->
<!--                                <option :value="null">&#45;&#45; Wybierz dostawcę &#45;&#45;</option>-->
<!--                                <option v-for="dostawca in dostawcy" :key="dostawca.id" :value="dostawca.id">-->
<!--                                    [[ dostawca.nazwa_firmy ]]-->
<!--                                </option>-->
<!--                            </select>-->
<!--                        </div>-->
<!--                        <div class="mb-3">-->
<!--                            <label class="form-label">Uwagi</label>-->
<!--                            <textarea class="form-control" rows="3" v-model="zamowienieModal.currentItem.uwagi"></textarea>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="modal-footer">-->
<!--                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>-->
<!--                        <button type="button" class="btn btn-primary" @click="saveZamowienie" :disabled="isSaving">-->
<!--                            <span v-if="isSaving" class="spinner-border spinner-border-sm me-1"></span>-->
<!--                            Zapisz-->
<!--                        </button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    <script src="{% static 'js/vue.global.js' %}"></script>-->
<!--    <script src="{% static 'js/axios.min.js' %}"></script>-->
<!--    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>-->
<!--    <script src="{% static 'js/main_zamowienia.js' %}?v=1.0"></script>-->
<!--</body>-->
<!--</html>-->